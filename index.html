<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GhostLink Chat</title>
<style>
body { background: black; color: #00ff00; font-family: monospace; }
#chat { border: 1px solid #00ff00; padding: 10px; height: 200px; overflow-y: scroll; }
input, button { background: black; color: #00ff00; border: 1px solid #00ff00; padding: 5px; }
button { cursor: pointer; }
</style>
</head>
<body>
<h2>GhostLink Chat</h2>
<div id="chat"></div>
<input type="text" id="message" placeholder="Type your message">
<button onclick="sendMessage()">Send</button>

<script>
var SERVER_URL = "https://web-production-ea9fc.up.railway.app";

function loadMessages() {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", SERVER_URL + "/receive", true);
    xhr.onreadystatechange = function() {
        if(xhr.readyState === 4 && xhr.status === 200) {
            try {
                var data = JSON.parse(xhr.responseText);
                var chatDiv = document.getElementById("chat");
                var html = "";
                for(var i=0; i<data.length; i++){
                    html += "<b>" + data[i].sender + ":</b> " + data[i].text + " <i>" + data[i].time + "</i><br>";
                }
                chatDiv.innerHTML = html;
                chatDiv.scrollTop = chatDiv.scrollHeight;
            } catch(e){ console.log("Error parsing messages", e); }
        }
    };
    xhr.send();
}

function sendMessage() {
    var msgInput = document.getElementById("message");
    var msg = msgInput.value;
    if(!msg) return;

    var xhr = new XMLHttpRequest();
    xhr.open("POST", SERVER_URL + "/send", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function() {
        if(xhr.readyState === 4 && xhr.status === 200){
            msgInput.value = "";
            loadMessages();
        }
    };
    var payload = JSON.stringify({ sender: "Ghost", text: msg });
    xhr.send(payload);
}

// Auto-refresh every 3 seconds
setInterval(loadMessages, 3000);
window.onload = loadMessages;
</script>
</body>
</html>
